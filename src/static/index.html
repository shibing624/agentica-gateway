<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agentica</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%234A90D9'/%3E%3Cstop offset='100%25' stop-color='%23A8D8EA'/%3E%3C/linearGradient%3E%3ClinearGradient id='body' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23E8F4FD'/%3E%3Cstop offset='100%25' stop-color='%23d0e8f8'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23bg)'/%3E%3Cpath d='M28 38 L22 18 L38 30 Z' fill='%23E8F4FD'/%3E%3Cpath d='M72 38 L78 18 L62 30 Z' fill='%23E8F4FD'/%3E%3Cpath d='M28 38 L22 18 L38 30' fill='none' stroke='%23d0e8f8' stroke-width='1'/%3E%3Cpath d='M72 38 L78 18 L62 30' fill='none' stroke='%23d0e8f8' stroke-width='1'/%3E%3Cellipse cx='50' cy='52' rx='28' ry='28' fill='url(%23body)'/%3E%3Ccircle cx='39' cy='46' r='4.5' fill='%232C3E50'/%3E%3Ccircle cx='61' cy='46' r='4.5' fill='%232C3E50'/%3E%3Ccircle cx='40.2' cy='44.8' r='1.5' fill='white'/%3E%3Ccircle cx='62.2' cy='44.8' r='1.5' fill='white'/%3E%3Cellipse cx='50' cy='55' rx='3.5' ry='2' fill='%23F4A0B0'/%3E%3Cpath d='M46.5 55 Q50 59 53.5 55' stroke='%232C3E50' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3Cline x1='28' y1='52' x2='16' y2='48' stroke='%23ccc' stroke-width='1' stroke-linecap='round'/%3E%3Cline x1='28' y1='55' x2='16' y2='55' stroke='%23ccc' stroke-width='1' stroke-linecap='round'/%3E%3Cline x1='72' y1='52' x2='84' y2='48' stroke='%23ccc' stroke-width='1' stroke-linecap='round'/%3E%3Cline x1='72' y1='55' x2='84' y2='55' stroke='%23ccc' stroke-width='1' stroke-linecap='round'/%3E%3C/svg%3E">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
<link rel="stylesheet" href="/static/style.css">
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar" id="sidebar">
  <div class="side-head">
    <div class="brand">
      <img class="brand-logo" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%234A90D9'/%3E%3Cstop offset='100%25' stop-color='%23A8D8EA'/%3E%3C/linearGradient%3E%3ClinearGradient id='body' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23E8F4FD'/%3E%3Cstop offset='100%25' stop-color='%23d0e8f8'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23bg)'/%3E%3Cpath d='M28 38 L22 18 L38 30 Z' fill='%23E8F4FD'/%3E%3Cpath d='M72 38 L78 18 L62 30 Z' fill='%23E8F4FD'/%3E%3Cpath d='M28 38 L22 18 L38 30' fill='none' stroke='%23d0e8f8' stroke-width='1'/%3E%3Cpath d='M72 38 L78 18 L62 30' fill='none' stroke='%23d0e8f8' stroke-width='1'/%3E%3Cellipse cx='50' cy='52' rx='28' ry='28' fill='url(%23body)'/%3E%3Ccircle cx='39' cy='46' r='4.5' fill='%232C3E50'/%3E%3Ccircle cx='61' cy='46' r='4.5' fill='%232C3E50'/%3E%3Ccircle cx='40.2' cy='44.8' r='1.5' fill='white'/%3E%3Ccircle cx='62.2' cy='44.8' r='1.5' fill='white'/%3E%3Cellipse cx='50' cy='55' rx='3.5' ry='2' fill='%23F4A0B0'/%3E%3Cpath d='M46.5 55 Q50 59 53.5 55' stroke='%232C3E50' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3Cline x1='28' y1='52' x2='16' y2='48' stroke='%23ccc' stroke-width='1' stroke-linecap='round'/%3E%3Cline x1='28' y1='55' x2='16' y2='55' stroke='%23ccc' stroke-width='1' stroke-linecap='round'/%3E%3Cline x1='72' y1='52' x2='84' y2='48' stroke='%23ccc' stroke-width='1' stroke-linecap='round'/%3E%3Cline x1='72' y1='55' x2='84' y2='55' stroke='%23ccc' stroke-width='1' stroke-linecap='round'/%3E%3C/svg%3E" alt="logo">
      <span>Agentica</span>
      <span class="brand-ver" id="verLabel">v0.1.1</span>
    </div>
    <button class="new-btn" onclick="newSession()">+ New</button>
  </div>
  <div class="side-search">
    <input type="text" id="searchInput" placeholder="Search..." oninput="filterSessions()">
  </div>
  <div class="s-list" id="sessionList"><div class="s-empty">No sessions</div></div>
</aside>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <div class="tb-l">
      <button class="ib" onclick="toggleSidebar()" title="Toggle sidebar">
        <svg viewBox="0 0 16 16" width="16" height="16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><rect x="1.5" y="2.5" width="13" height="11" rx="2"/><line x1="5.5" y1="2.5" x2="5.5" y2="13.5"/></svg>
      </button>
      <!-- Model selector -->
      <div style="position:relative" id="modelWrap">
        <button class="model-sel" id="modelBtn" onclick="toggleModelDD()">
          <span id="modelLabel">-</span>
          <span class="arr">&#x25BC;</span>
        </button>
        <div class="model-dd" id="modelDD"></div>
      </div>
    </div>
    <div class="tb-r">
      <div class="tb-info">
        <span class="tok-wrap">
          Tokens: <b id="tokIn">0</b> in / <b id="tokOut">0</b> out
          <span class="tok-tip" id="tokTip">Session tokens — Input: prompt + context, Output: generated response</span>
        </span>
        <span class="sep">|</span>
        <span class="dir-wrap" id="dirWrap" onclick="openDirModal()">
          Dir: <b id="dirVal">-</b>
        </span>
      </div>
      <button class="ib" onclick="toggleTheme()" id="themeBtn" title="Toggle theme">&#x263E;</button>
    </div>
  </div>

  <div class="chat-wrap">
    <div class="chat" id="chatArea">
      <div class="msgs" id="messages"></div>
    </div>
    <button class="scroll-bottom-btn" id="scrollBottomBtn" onclick="scrollEnd()" title="Scroll to bottom">
      <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3v10m0 0l-4-4m4 4l4-4"/></svg>
    </button>
  </div>

  <div class="input-area">
    <div class="input-box" id="inputBox">
      <div class="file-list" id="fileList"></div>
      <textarea class="input-ta" id="inputTa" placeholder="Send a message..." rows="1"
        onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
      <div class="input-foot">
        <div class="input-foot-l">
          <button class="attach-btn" onclick="document.getElementById('fileInput').click()" title="Attach file">&#x1F4CE;</button>
          <input type="file" id="fileInput" multiple style="display:none" onchange="onFilePick(event)">
        </div>
        <div class="input-foot-r">
          <button class="act-btn send" id="actBtn" onclick="onAction()" title="Send (Enter)"><svg viewBox="0 0 16 16" width="16" height="16"><path d="M12 3v5a2 2 0 01-2 2H4m0 0l3-3M4 10l3 3" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
        </div>
      </div>
    </div>
    <div class="bottom-info">AI 可能会犯错，请核实重要信息。</div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Dir Modal -->
<div class="dir-modal-overlay" id="dirModalOverlay" onclick="closeDirModal(event)">
  <div class="dir-modal" onclick="event.stopPropagation()">
    <h3>Working Directory</h3>
    <div class="dm-row">
      <div class="dir-input-wrap">
        <input type="text" id="dirEditInput" placeholder="/path/to/project"
               onkeydown="if(event.key==='Enter')saveDir()"
               oninput="filterDirHistory()">
        <button class="dir-toggle-btn" id="dirToggleBtn" onclick="toggleDirHistory()" title="历史路径">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6l4 4 4-4"/></svg>
        </button>
        <div class="dir-history-dropdown" id="dirHistoryDD"></div>
      </div>
    </div>
    <div class="dm-actions">
      <div class="dm-left">
        <button class="dp-btn" onclick="copyDir()" title="Copy path">
          <svg viewBox="0 0 16 16"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"/></svg>
          Copy
        </button>
        <button class="dp-btn" onclick="openInFinder()" title="Open in Finder">
          <svg viewBox="0 0 16 16"><path d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/></svg>
          Finder
        </button>
        <button class="dp-btn" onclick="openInTerminal()" title="Open in Terminal">
          <svg viewBox="0 0 16 16"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0114.25 15H1.75A1.75 1.75 0 010 13.25V2.75zm7 7.5a.75.75 0 000 1.5h4.25a.75.75 0 000-1.5H7zm-3.22-4.97a.75.75 0 00-1.06 1.06L4.44 8 2.72 9.72a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2z"/></svg>
          Terminal
        </button>
      </div>
      <div class="dm-right">
        <button class="dp-btn" onclick="closeDirModal()">Cancel</button>
        <button class="dp-btn primary" onclick="saveDir()">Save</button>
      </div>
    </div>
  </div>
</div>

<!-- Confirm Modal -->
<div class="confirm-overlay" id="confirmOverlay" onclick="confirmCancel(event)">
  <div class="confirm-box" onclick="event.stopPropagation()">
    <div class="cm-msg" id="confirmMsg">确定删除？</div>
    <div class="cm-actions">
      <button class="dp-btn" onclick="confirmCancel()">取消</button>
      <button class="dp-btn danger" id="confirmOkBtn" onclick="confirmOk()">删除</button>
    </div>
  </div>
</div>

<script src="/static/app.js"></script>
</body>
</html>
